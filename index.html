<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Making your first Phaser 3 Game - Part 1</title>
  <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
  <style type="text/css">
    body {
      margin: 0;
    }
  </style>
</head>

<body>

  <script type="text/javascript">

    const config = {
      type: Phaser.AUTO,
      width: 640,
      height: 400,
      physics: {
        default: "arcade",
        arcade: {
          gravity: { y: 0 } // Top down game, so no gravity
        }
      },
      scene: {
        preload: preload,
        create: create,
        update: update
      }
    };

    const game = new Phaser.Game(config);

    let player;

    function preload() {
      // load the PNG file
      this.load.image('tileset', 'assets/tileset.png')
      
      this.load.image('misa-front', 'assets/misa-front.png')
      // load the JSON file
      this.load.tilemapTiledJSON('map', 'assets/map.json')
    }

    function create() {
      const map = this.make.tilemap({ key: 'map', tileWidth: 16, tileHeight: 16 });
      const tileset = map.addTilesetImage("tileset");

      // Parameters: layer name (or index) from Tiled, tileset, x, y
      const belowLayer = map.createStaticLayer("belowplayer", tileset, 0, 0);
      player = this.physics.add.sprite(400, 350, "misa-front");
      const worldLayer = map.createStaticLayer("world", tileset, 0, 0);
      const aboveLayer = map.createStaticLayer("aboveplayer", tileset, 0, 0);

      //worldLayer.setCollisionByProperty({ "collides": true });
      worldLayer.setCollision([323, 35, 289, 257, 225, 227, 3, 261, 258, 290, 293, 294, 226, 262]);
      const debugGraphics = this.add.graphics().setAlpha(0.75);

      worldLayer.renderDebug(debugGraphics, {
        tileColor: null, // Color of non-colliding tiles
        collidingTileColor: new Phaser.Display.Color(243, 134, 48, 255), // Color of colliding tiles
        faceColor: new Phaser.Display.Color(40, 39, 37, 255) // Color of colliding face edges
      });

      cursors = this.input.keyboard.createCursorKeys();
      this.physics.add.collider(player, worldLayer);
    }

    function update() {
      // Stop any previous movement from the last frame
      player.body.setVelocity(0);

      // Horizontal movement
      if (cursors.left.isDown) {
        player.body.setVelocityX(-100);
      } else if (cursors.right.isDown) {
        player.body.setVelocityX(100);
      }

      // Vertical movement
      if (cursors.up.isDown) {
        player.body.setVelocityY(-100);
      } else if (cursors.down.isDown) {
        player.body.setVelocityY(100);
      }

      // Normalize and scale the velocity so that player can't move faster along a diagonal
      //player.body.velocity.normalize().scale(speed);
    }

  </script>

</body>

</html>